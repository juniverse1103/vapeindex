---
// Register form component
---

<div class="auth-form">
  <h2>Join VapeIndex</h2>
  <p class="subtitle">Create your account to join the community</p>

  <form id="register-form">
    <div class="form-group">
      <label for="username">Username</label>
      <input
        type="text"
        id="username"
        name="username"
        required
        autocomplete="username"
        placeholder="Choose a username"
        pattern="[a-zA-Z0-9_-]{3,20}"
        title="3-20 characters, letters, numbers, dashes and underscores only"
      />
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        autocomplete="email"
        placeholder="your@email.com"
      />
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        name="password"
        required
        autocomplete="new-password"
        placeholder="At least 8 characters"
        minlength="8"
      />
      <small>Minimum 8 characters</small>
    </div>

    <div class="form-group">
      <label for="confirm-password">Confirm Password</label>
      <input
        type="password"
        id="confirm-password"
        name="confirm-password"
        required
        autocomplete="new-password"
        placeholder="Confirm your password"
        minlength="8"
      />
    </div>

    <button type="submit" class="btn btn-primary" id="register-btn">
      Create Account
    </button>

    <div id="register-error" class="error-message" style="display: none;"></div>
    <div id="register-success" class="success-message" style="display: none;"></div>
  </form>

  <p class="switch-form">
    Already have an account? <a href="/login">Log in</a>
  </p>
</div>

<style>
  .auth-form {
    max-width: 400px;
    margin: 0 auto;
    padding: 2rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  h2 {
    margin: 0 0 0.5rem;
    font-size: 1.75rem;
    color: #1a1a1a;
  }

  .subtitle {
    margin: 0 0 2rem;
    color: #666;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
  }

  input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s;
  }

  input:focus {
    outline: none;
    border-color: #10b981;
  }

  small {
    display: block;
    margin-top: 0.25rem;
    color: #666;
    font-size: 0.85rem;
  }

  .btn {
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: #10b981;
    color: white;
  }

  .btn-primary:hover {
    background: #059669;
  }

  .btn-primary:disabled {
    background: #9ca3af;
    cursor: not-allowed;
  }

  .error-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #fee2e2;
    color: #dc2626;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  .success-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #d1fae5;
    color: #059669;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  .switch-form {
    margin-top: 2rem;
    text-align: center;
    color: #666;
  }

  .switch-form a {
    color: #10b981;
    text-decoration: none;
    font-weight: 500;
  }

  .switch-form a:hover {
    text-decoration: underline;
  }
</style>

<script>
  import { register } from '../../lib/auth';

  const form = document.getElementById('register-form') as HTMLFormElement;
  const errorDiv = document.getElementById('register-error') as HTMLDivElement;
  const successDiv = document.getElementById('register-success') as HTMLDivElement;
  const submitBtn = document.getElementById('register-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const username = formData.get('username') as string;
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;
    const confirmPassword = formData.get('confirm-password') as string;

    // Clear previous messages
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';

    // Validate passwords match
    if (password !== confirmPassword) {
      errorDiv.textContent = 'Passwords do not match';
      errorDiv.style.display = 'block';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Creating account...';

    const result = await register(email, username, password);

    if (result.success) {
      successDiv.textContent = result.message || 'Account created! Please check your email to verify your account.';
      successDiv.style.display = 'block';
      form.reset();

      // Redirect to login after 3 seconds
      setTimeout(() => {
        window.location.href = '/login';
      }, 3000);
    } else {
      errorDiv.textContent = result.error || 'Registration failed';
      errorDiv.style.display = 'block';
      submitBtn.disabled = false;
      submitBtn.textContent = 'Create Account';
    }
  });
</script>
