---
// Login form component
---

<div class="auth-form">
  <h2>Welcome back</h2>
  <p class="subtitle">Log in to your VapeIndex account</p>

  <form id="login-form">
    <div class="form-group">
      <label for="email">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        autocomplete="email"
        placeholder="your@email.com"
      />
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input
        type="password"
        id="password"
        name="password"
        required
        autocomplete="current-password"
        placeholder="Enter your password"
        minlength="8"
      />
    </div>

    <div class="form-actions">
      <a href="/forgot-password" class="forgot-link">Forgot password?</a>
    </div>

    <button type="submit" class="btn btn-primary" id="login-btn">
      Log in
    </button>

    <div id="login-error" class="error-message" style="display: none;"></div>
    <div id="login-success" class="success-message" style="display: none;"></div>
  </form>

  <p class="switch-form">
    Don't have an account? <a href="/register">Sign up</a>
  </p>
</div>

<style>
  .auth-form {
    max-width: 400px;
    margin: 0 auto;
    padding: 2rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  h2 {
    margin: 0 0 0.5rem;
    font-size: 1.75rem;
    color: #1a1a1a;
  }

  .subtitle {
    margin: 0 0 2rem;
    color: #666;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
  }

  input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s;
  }

  input:focus {
    outline: none;
    border-color: #10b981;
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 1.5rem;
  }

  .forgot-link {
    color: #10b981;
    text-decoration: none;
    font-size: 0.9rem;
  }

  .forgot-link:hover {
    text-decoration: underline;
  }

  .btn {
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: #10b981;
    color: white;
  }

  .btn-primary:hover {
    background: #059669;
  }

  .btn-primary:disabled {
    background: #9ca3af;
    cursor: not-allowed;
  }

  .error-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #fee2e2;
    color: #dc2626;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  .success-message {
    margin-top: 1rem;
    padding: 0.75rem;
    background: #d1fae5;
    color: #059669;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  .switch-form {
    margin-top: 2rem;
    text-align: center;
    color: #666;
  }

  .switch-form a {
    color: #10b981;
    text-decoration: none;
    font-weight: 500;
  }

  .switch-form a:hover {
    text-decoration: underline;
  }
</style>

<script>
  import { login } from '../../lib/auth';
  import { setAuthState } from '../../lib/authStore';

  const form = document.getElementById('login-form') as HTMLFormElement;
  const errorDiv = document.getElementById('login-error') as HTMLDivElement;
  const successDiv = document.getElementById('login-success') as HTMLDivElement;
  const submitBtn = document.getElementById('login-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;

    // Clear previous messages
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    submitBtn.disabled = true;
    submitBtn.textContent = 'Logging in...';

    const result = await login(email, password);

    if (result.success && result.data) {
      successDiv.textContent = 'Login successful! Redirecting...';
      successDiv.style.display = 'block';

      // Update auth state
      setAuthState(result.data.user);

      // Redirect to home after short delay
      setTimeout(() => {
        window.location.href = '/';
      }, 1000);
    } else {
      errorDiv.textContent = result.error || 'Login failed';
      errorDiv.style.display = 'block';
      submitBtn.disabled = false;
      submitBtn.textContent = 'Log in';
    }
  });
</script>
